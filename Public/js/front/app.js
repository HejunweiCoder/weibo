function initApp(){$(document).pjax("[data-pjax]","#main_container"),$(document).on("pjax:start",function(){$(".emoji_btn").remove()}),$(document).on("submit","form[data-pjax]",function(e){$.pjax.submit(e,"#main_container")}),$("#register").click(function(){$("#login_modal").modal("hide")});var navbar=$("#navbar");navbar.find("li").on("click",function(){navbar.find("li").removeClass("active"),$(this).addClass("active")}),navbar.find("a").each(function(){(location.pathname+"/").indexOf($(this).attr("href")+"/")!=-1&&(navbar.find("li").removeClass("active"),$(this).parent().addClass("active"))}),initLogin(),initRegister()}function initPost(){var post=($("#post_form"),$("#post")),num=$("#number");post.focus(function(){$(this).emoji({icons:[{name:"QQ表情",path:"/vendor/img/qq/",maxNum:91,excludeNums:[41,45,54],file:".gif",placeholder:"#qq_{alias}#"},{name:"贴吧表情",path:"/vendor/img/tieba/",maxNum:50,file:".jpg",placeholder:"#tieba_{alias}#"}]});var emojiTotal=$(this).find("img").length,total=280,len=$(this).text().length;num.html(total-len-emojiTotal),num.html()<0&&alert("超出范围"),$("#post_content").val($(this).html())}),post.on("keyup click",function(){var emojiTotal=$(this).find("img").length,total=280,len=$(this).text().length;num.html(total-len-emojiTotal),num.html()<0&&alert("超出范围"),$("#post_content").val($(this).html())}),$(".img").click(function(){$(this).hide(),$(this).next().show()}),$(".img-zoom").click(function(){$(this).hide(),$(this).prev().show()})}function emailAutoComplete(){var arrs=[],emails=["qq.com","163.com","gmail.com","129.com","yahoo.com"],email=$("#register_email"),inputVal=email.val();$.each(emails,function(index,info){inputVal.indexOf("@")==-1?arrs[index]=inputVal+"@"+info:arrs[index]=inputVal.substring(0,inputVal.indexOf("@"))+"@"+info}),email.autocomplete({source:arrs,autoFocus:!0}),email.autocomplete("option","appendTo","#register_form")}function initLogin(){initForm(null,$("#login_form"),$("#login_modal"),"登录成功","登录失败")}function initRegister(){$registerRules={username:{remote:{url:"/check-username",type:"POST",beforeSend:function(){$("#username-status").addClass("fa fa-refresh")},complete:function(jqXHR){1==jqXHR.responseText?$("#username-status").addClass("fa-check").removeClass("fa-refresh"):$("#username-status").removeClass("fa-refresh fa-check")}}},email:{remote:{url:"/check-email",type:"POST",beforeSend:function(){$("#email-status").addClass("fa fa-refresh")},complete:function(jqXHR){1==jqXHR.responseText?$("#email-status").removeClass("fa-refresh").addClass("fa-check"):$("#email-status").removeClass("fa-refresh fa-check")}}}},initForm($registerRules,$("#register_form"),$("#register_modal"),"注册成功","注册失败")}function initForm($rules,$form,$modal,success,fail){var options={rules:$rules,ignore:".ignore",highlight:function(el){$(el).closest(".form-group").addClass("has-error"),$(el).closest(".form-group").find(".help-block").addClass("hidden")},unhighlight:function(el){$(el).closest(".form-group").removeClass("has-error"),$(el).closest(".form-group").find(".help-block").addClass("hidden")},errorPlacement:function(error,element){element.parent(".input-group").length?error.insertAfter(element.parent()):error.insertAfter(element)},submitHandler:function(form){$.ajax({url:$(form).prop("action"),type:"POST",data:$(form).serializeArray()}).done(function(data){"success"==data?(swal(success,"","success"),$modal&&$modal.modal("hide"),location.reload()):swal(fail,data,"error")})}};$form.validate(options)}